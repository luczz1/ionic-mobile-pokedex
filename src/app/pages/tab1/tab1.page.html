<ion-header [translucent]="true">
  <ion-toolbar color="danger">
    <ion-title> Pokédex </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [hidden]="showDetails">
  <ion-searchbar
    (ionChange)="filterPokemonList($event)"
    class="ion-padding"
    placeholder="Pesquisar por nome..."
    color="light"
  ></ion-searchbar>
  <ion-grid class="ion-text-center">
    <ion-row>
      <ion-col
        class="ion-padding"
        style="border-bottom: 1px solid var(--ion-color-light)"
      >
        <ion-item
          style="padding: 4px"
          fill="light"
          *ngFor="let poke of filteredPokemonList.length > 0 ? filteredPokemonList : pokemonList;"
          (click)="getPokemonDetails(poke.id)"
          lines="none"
        >
          <ion-img
            src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/{{poke.id}}.png"
            alt=""
          ></ion-img>
          <p
            style="
              font-size: 14px;
              background-color: var(--ion-color-light-tint);
              padding: 10px;
              width: 100%;
              border-radius: 8px;
            "
          >
            {{poke.id}}. {{poke.name | titlecase}}
          </p>
        </ion-item>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-content [fullscreen]="true" *ngIf="showDetails">
  <!-- *ngFor="let poke of pokemonDetails; -->

  <ion-card *ngFor="let details of pokemonDetails" class="ion-text-center">
    <ion-button class="button-transparent" (click)="toggleShowDetails()"
      ><ion-icon name="arrow-back-outline"></ion-icon
      ><span style="text-indent: 8px; text-transform: capitalize !important"
        >Voltar</span
      ></ion-button
    >
    <ion-slides pager="true">
      <ion-slide>
        <img
          style="min-width: 50%; max-width: 50% !important"
          alt="Sprite de frente"
          src="{{details.sprites.front_default}}"
        />
      </ion-slide>
      <ion-slide>
        <img
          style="min-width: 50%; max-width: 50% !important"
          alt="Sprite de costas"
          src="{{details.sprites.back_default}}"
        />
      </ion-slide>
      <ion-slide>
        <img
          style="min-width: 50%; max-width: 50% !important"
          alt="Sprite de frente shiny"
          src="{{details.sprites.front_shiny}}"
        />
      </ion-slide>
      <ion-slide>
        <img
          style="min-width: 50%; max-width: 50% !important"
          alt="Sprite de costas shiny"
          src="{{details.sprites.back_shiny}}"
        />
      </ion-slide>
    </ion-slides>
    <ion-card-header>
      <ion-card-title
        >{{details.id}}. {{details.name | titlecase}}</ion-card-title
      >
      <ion-card-subtitle
        ><span
          *ngFor="let types of details.types"
          (click)="getTypeDetails(types.type.url)"
          id="type-modal{{types.type.name}}"
          expand="block"
          ><img
            style="margin: 6px"
            width="15%"
            src="../../../assets/types-icon/{{types.type.name}}.png"
            alt="" />
          <ion-modal trigger="type-modal{{types.type.name}}">
            <ng-template>
              <ion-header>
                <ion-toolbar>
                  <ion-title
                    >Tipo: {{types.type.name | translateType}}</ion-title
                  >
                  <ion-buttons slot="end">
                    <ion-button (click)="closeModal()"
                      ><ion-icon name="close-outline"></ion-icon
                    ></ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <div
                class="ion-text-center ion-padding"
                style="border-bottom: 1px solid var(--ion-color-light)"
              >
                <img
                  style="margin: 6px"
                  width="25%"
                  src="../../../assets/types-icon/{{types.type.name}}.png"
                  alt=""
                />
              </div>

              <ion-content class="ion-padding">
                <div *ngFor="let values of typeList; index as i">
                  <div>
                    <p>Fraco contra</p>
                    <span style="padding: 4px">
                      <img
                        *ngFor="let rel of values.damage_relations.double_damage_from"
                        style="margin: 6px"
                        width="15%"
                        src="../../../assets/types-icon/{{rel.name}}.png"
                        alt=""
                      />
                    </span>
                  </div>
                  <div>
                    <p>Forte contra</p>
                    <span style="padding: 4px">
                      <img
                        *ngFor="let rel of values.damage_relations.double_damage_to"
                        style="margin: 6px"
                        width="15%"
                        src="../../../assets/types-icon/{{rel.name}}.png"
                        alt=""
                      />
                    </span>
                  </div>
                  <div>
                    <p>Recebe dano normal contra</p>
                    <span style="padding: 4px">
                      <img
                        *ngFor="let rel of values.damage_relations.half_damage_from"
                        style="margin: 6px"
                        width="15%"
                        src="../../../assets/types-icon/{{rel.name}}.png"
                        alt=""
                      />
                    </span>
                  </div>
                  <div>
                    <p>Causa dano normal contra</p>
                    <span style="padding: 4px">
                      <img
                        *ngFor="let rel of values.damage_relations.half_damage_to"
                        style="margin: 6px"
                        width="15%"
                        src="../../../assets/types-icon/{{rel.name}}.png"
                        alt=""
                      />
                    </span>
                  </div>
                </div>
              </ion-content>
            </ng-template> </ion-modal
        ></span>
      </ion-card-subtitle>
      <div
        style="border-top: 1px solid var(--ion-color-light-tint); padding: 6px"
      >
        <p>
          <b>Habilidades:</b>
        </p>
        <span
          style="padding: 4px"
          *ngFor="let ability of details.abilities"
          (click)="getAbilityDetails(ability.ability.url)"
          id="click-trigger{{ability.ability.name}}"
          >{{ability.ability.name | titlecase}}

          <ion-popover
            trigger="click-trigger{{ability.ability.name}}"
            triggerAction="click"
          >
            <ng-template>
              <div *ngFor="let abilityDesc of abilityList">
                <div
                  style="padding: 4px; overflow-y: auto; max-height: 80px;"
                  *ngFor="let entries of abilityDesc.effect_entries; index as i"
                >
                  <span *ngIf="entries.language.name === 'en'"
                    >{{entries.effect}}</span
                  >
                </div>
              </div>
            </ng-template>
          </ion-popover></span
        >
      </div>
    </ion-card-header>

    <ion-card-content style="border-top: 1px solid var(--ion-color-light-tint)">
      <div
        *ngFor="let stats of details.stats"
        style="
          text-align: left !important;
          display: flex;
          justify-content: space-between;
          margin-top: 12px;
        "
      >
        <div>{{stats.stat.name | titlecase}}</div>
        <div>
          {{stats.base_stat}}
          <!-- <progress value="{{stats.base_stat}}" max="200">
            {{stats.base_stat}}
          </progress>
          200 -->
        </div>
      </div>
      <div
        style="
          border-top: 1px solid var(--ion-color-light-tint);
          margin-top: 8px;
        "
      >
        <div
          style="display: flex; justify-content: space-between; margin-top: 8px"
        >
          <div
            (click)="details.id > 1 ? getPokemonDetails(pokemonList[details.id - 2].id) : ''"
          >
            <p>Anterior</p>
            <img
              src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/{{details.id > 1 ? pokemonList[details.id - 2].id : '0'}}.png"
              alt=""
            />
            <p>
              {{details.id > 1 ? (pokemonList[details.id - 2].name | titlecase)
              : 'Nenhum'}}
            </p>
          </div>

          <div
            (click)="details.id < 151 ? getPokemonDetails(pokemonList[details.id].id) : ''"
          >
            <p>Próximo</p>
            <img
              src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/{{details.id < 151 ? pokemonList[details.id].id : '0'}}.png"
              alt=""
            />
            <p>
              {{details.id < 151 ? (pokemonList[details.id].name | titlecase) :
              'Nenhum'}}
            </p>
          </div>
        </div>
      </div>
      <!-- <div style="border-top: 1px solid var(--ion-color-dark); margin-top: 8px; margin-bottom: 8px;">
        <div>
          <p>Pode aprender:</p>
          <span *ngFor="let moves of details.moves">{{moves.move.name | titlecase}} </span>
        </div>
      </div> -->
    </ion-card-content>
  </ion-card>
</ion-content>
